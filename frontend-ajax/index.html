<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
            <title>
                Ajax - BBQ
            </title>
            <!-- Materialize CSS -->
            <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css" rel="stylesheet">
                <!-- JavaScript for: jQuery, angular, materialize, and angular-materialize. All of which are needed. -->
                <script src="https://code.jquery.com/jquery-3.1.1.min.js" type="text/javascript">
                </script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js" type="text/javascript">
                </script>
                <link href="css/style.css" rel="stylesheet">
                </link>
            </link>
        </meta>
    </head>
    <body>
        <header>
            <div class="row">
            </div>
        </header>
        <main class="container">
            <div class="row center">
                <div class="input-field col s12 m4 l4">
                    <button class="btn waves-effect waves-light" onclick="novo()">
                        Novo
                    </button>
                </div>
                <div class="input-field col s12 m4 l4">
                    <button class="btn waves-effect waves-light" onclick="salvar()">
                        Salvar
                    </button>
                </div>
            </div>
            <form class="form-inline" name="formChurrasco">
                <div class="row">
                    <div class="input-field col s12 m4 l4">
                        ID
                        <input id="id" name="id" type="number">
                        </input>
                    </div>
                    <div class="input-field col s12 m4 l4">
                        Carne
                        <input id="carne" name="carne" type="text">
                        </input>
                    </div>
                    <div class="input-field col s12 m4 l4">
                        Peso
                        <input id="peso" name="peso" type="number">
                        </input>
                    </div>
                </div>
            </form>
            <table id="lista-carne" class="highlight centered">
                <thead>
                    <tr>
                        <th>
                            ID
                        </th>
                        <th>
                            Carne
                        </th>
                        <th>
                            Peso
                        </th>
                        <th>
                            Editar
                        </th>
                        <th>
                            Excluir
                        </th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </main>
    </body>
    <script type="text/javascript">
        var ws = 'http://localhost:5000/churrasco'

        $(document).ready(function() {
            $.ajax({
                url: ws + '/buscarTodos',
                dataType: 'json',
                success: function(data) {
                    populateTable(data);
                }
            });
        });

        function novo() {
            $("#id").val('');
            $("#carne").val('');
            $("#peso").val('');;
        }

        function editar(id) {
            $.ajax({
                url: ws + '/buscarPorId/' + id,
                dataType: 'json',
                success: function(data) {
                    $("#id").val(data[0].id);
                    $("#carne").val(data[0].carne);
                    $("#peso").val(data[0].peso);
                }
            });
        }

        //TODO: escrever o método de salvar

        function remover(id) {
            $.ajax({
                url: ws + '/remover',
                type: "POST",
                dataType: 'json',
                data: {
                    id: id
                },
                success: function(data) {
                    /** Após o sucesso na remoção,
                    * busco todos os registros
                    * e populo novamente a tabela
                    **/
                    $.ajax({
                        url: ws + '/buscarTodos',
                        dataType: 'json',
                        success: function(data) {
                            populateTable(data);
                        }
                    });
                }
            });
        }

        function populateTable(data) {
            $("#lista-carne > tbody").empty();
            $.each(data, function() {
                $("#lista-carne > tbody").append(`<tr>` +
                    `<td>` + this.id + `</td>` +
                    `<td><b>` + this.carne + `</b></td>` +
                    `<td>` + this.peso + `kg</td>` +
                    `<td><a onclick="editar(` + this.id + `)"><img class="responsive-img lista-img" src="img/edit.png"/></a></td>` +
                    `<td><a onclick="remover(` + this.id + `)"><img class="responsive-img lista-img" src="img/remove.png"/></a></td>` +
                    `</tr>`);
            })
        }
    </script>
</html>